<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–Ω–∞–∂—ë—Ä</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .card {
            background: white;
            color: black;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            width: 100%;
        }
        .hidden {
            display: none;
        }
        .debug-info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            max-width: 300px;
            z-index: 10000;
        }
    </style>
</head>
<body>
    <div class="debug-info" id="debugInfo">
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...
    </div>

    <div class="container">
        <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="mainScreen" class="hidden">
            <div style="text-align: center; margin-bottom: 30px;">
                <h1>üéì –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–Ω–∞–∂—ë—Ä</h1>
                <p>–°—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è</p>
            </div>
            
            <div class="card">
                <h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã:</h3>
                <button onclick="startTopic('trigonometry')">üìê –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è</button>
                <button onclick="startTopic('algebra')">üî¢ –ê–ª–≥–µ–±—Ä–∞</button>
                <button onclick="showTelegramInfo()">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Telegram</button>
            </div>
            
            <div class="card">
                <div id="userInfo">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ...</div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div id="loadingScreen">
            <div class="card">
                <div style="text-align: center;">
                    <h2>üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
                    <p id="loadingText">–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è...</p>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã -->
        <div id="quizScreen" class="hidden">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 id="topicTitle">–¢–µ–º–∞</h2>
            </div>
            
            <div class="card">
                <div style="font-size: 18px; margin-bottom: 20px;" id="questionText">–í–æ–ø—Ä–æ—Å</div>
                <div id="optionsContainer">
                    <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
                </div>
            </div>
            
            <div class="card hidden" id="resultCard">
                <h3 id="resultText"></h3>
                <p id="explanationText"></p>
                <button onclick="backToMain()">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let tg = null;
        let isTelegram = false;
        
        // –ü—Ä–æ—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        const simpleQuestions = {
            trigonometry: [
                {
                    question: "–ß–µ–º—É —Ä–∞–≤–µ–Ω sin(90¬∞)?",
                    options: ["0", "1", "-1", "0.5"],
                    correct: 1,
                    explanation: "sin(90¬∞) = 1"
                },
                {
                    question: "–ß–µ–º—É —Ä–∞–≤–µ–Ω cos(0¬∞)?",
                    options: ["0", "1", "-1", "0.5"], 
                    correct: 1,
                    explanation: "cos(0¬∞) = 1"
                }
            ],
            algebra: [
                {
                    question: "–ß–µ–º—É —Ä–∞–≤–µ–Ω (a + b)¬≤?",
                    options: ["a¬≤ + 2ab + b¬≤", "a¬≤ + b¬≤", "a¬≤ - 2ab + b¬≤", "a¬≤ - b¬≤"],
                    correct: 0,
                    explanation: "(a + b)¬≤ = a¬≤ + 2ab + b¬≤"
                }
            ]
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        function updateDebug(message) {
            const debug = document.getElementById('debugInfo');
            if (debug) {
                debug.innerHTML = message + '<br>' + debug.innerHTML;
            }
            console.log('DEBUG:', message);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        function updateLoading(text) {
            const loadingText = document.getElementById('loadingText');
            if (loadingText) {
                loadingText.textContent = text;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App - –ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–û–î–•–û–î
        function initTelegram() {
            updateDebug('1. –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram Web App...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏–º—Å—è –ª–∏ –º—ã –≤ Telegram
            if (window.Telegram && Telegram.WebApp) {
                updateDebug('2. Telegram Web App –æ–±–Ω–∞—Ä—É–∂–µ–Ω');
                tg = Telegram.WebApp;
                isTelegram = true;
                
                try {
                    // –í–ê–ñ–ù–û: ready() –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω –î–û –ª—é–±—ã—Ö –¥—Ä—É–≥–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
                    tg.ready();
                    updateDebug('3. tg.ready() —É—Å–ø–µ—à–Ω–æ');
                    
                    // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
                    setTimeout(() => {
                        updateDebug('4. –†–∞—Å—à–∏—Ä—è–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω');
                        
                        // –ü–ª–∞–≤–Ω–æ —Ä–∞—Å—à–∏—Ä—è–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
                        tg.expand();
                        
                        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ü–≤–µ—Ç–∞
                        tg.setHeaderColor('#667eea');
                        tg.setBackgroundColor('#667eea');
                        
                        updateDebug('5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                        showUserInfo();
                        
                    }, 100);
                    
                } catch (error) {
                    updateDebug('–û–®–ò–ë–ö–ê Telegram: ' + error.message);
                    handleTelegramError();
                }
            } else {
                updateDebug('2. –†–∞–±–æ—Ç–∞–µ–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–Ω–µ –≤ Telegram)');
                isTelegram = false;
                handleNonTelegram();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Telegram
        function handleTelegramError() {
            updateDebug('–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —Ä–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞');
            isTelegram = false;
            showMainScreen();
        }

        // –†–µ–∂–∏–º –±–µ–∑ Telegram
        function handleNonTelegram() {
            updateDebug('–ó–∞–ø—É—Å–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–º —Ä–µ–∂–∏–º–µ');
            setTimeout(() => {
                showMainScreen();
            }, 1000);
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        function showUserInfo() {
            const userInfo = document.getElementById('userInfo');
            
            if (isTelegram && tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                userInfo.innerHTML = `
                    <h3>üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:</h3>
                    <p><strong>–ò–º—è:</strong> ${user.first_name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                    <p><strong>ID:</strong> ${user.id}</p>
                    <p><strong>–Ø–∑—ã–∫:</strong> ${user.language_code || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                `;
            } else {
                userInfo.innerHTML = `
                    <h3>üë§ –ì–æ—Å—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º</h3>
                    <p>–í—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</p>
                `;
            }
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
        function showMainScreen() {
            updateDebug('–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω');
            updateLoading('–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('mainScreen').classList.remove('hidden');
            }, 500);
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ–º—É
        function startTopic(topic) {
            updateDebug('–ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ–º—É: ' + topic);
            
            document.getElementById('mainScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');
            
            const topicNames = {
                trigonometry: 'üìê –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è',
                algebra: 'üî¢ –ê–ª–≥–µ–±—Ä–∞'
            };
            
            document.getElementById('topicTitle').textContent = topicNames[topic] || topic;
            showQuestion(topic, 0);
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å
        function showQuestion(topic, index) {
            const questions = simpleQuestions[topic];
            if (!questions || index >= questions.length) {
                backToMain();
                return;
            }
            
            const question = questions[index];
            const optionsContainer = document.getElementById('optionsContainer');
            const resultCard = document.getElementById('resultCard');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            optionsContainer.innerHTML = '';
            resultCard.classList.add('hidden');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å
            document.getElementById('questionText').textContent = question.question;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
            question.options.forEach((option, i) => {
                const button = document.createElement('button');
                button.textContent = option;
                button.onclick = () => checkAnswer(i, question.correct, question.explanation);
                optionsContainer.appendChild(button);
            });
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç
        function checkAnswer(selected, correct, explanation) {
            const resultCard = document.getElementById('resultCard');
            const resultText = document.getElementById('resultText');
            const explanationText = document.getElementById('explanationText');
            
            if (selected === correct) {
                resultText.textContent = '‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!';
                resultText.style.color = '#4CAF50';
            } else {
                resultText.textContent = '‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ';
                resultText.style.color = '#f44336';
            }
            
            explanationText.textContent = explanation;
            resultCard.classList.remove('hidden');
        }

        // –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é
        function backToMain() {
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('mainScreen').classList.remove('hidden');
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ Telegram
        function showTelegramInfo() {
            let info = '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Telegram Web App:\n\n';
            info += 'isTelegram: ' + isTelegram + '\n';
            
            if (tg) {
                info += 'tg.version: ' + (tg.version || 'N/A') + '\n';
                info += 'tg.platform: ' + (tg.platform || 'N/A') + '\n';
                info += 'tg.initData: ' + (tg.initData ? '–ï—Å—Ç—å' : '–ù–µ—Ç') + '\n';
                
                if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    info += 'user: ' + tg.initDataUnsafe.user.first_name + '\n';
                }
            }
            
            alert(info);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            updateDebug('0. DOM –∑–∞–≥—Ä—É–∂–µ–Ω');
            updateLoading('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥, –ø–æ—Ç–æ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram
            setTimeout(() => {
                initTelegram();
            }, 100);
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
        window.addEventListener('error', function(e) {
            updateDebug('–ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –û–®–ò–ë–ö–ê: ' + e.message);
            console.error('Global error:', e);
        });
    </script>
</body>
</html>
