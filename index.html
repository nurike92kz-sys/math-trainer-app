<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–Ω–∞–∂—ë—Ä</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            color: black;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .question {
            font-size: 18px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .option:hover {
            background: #e9ecef;
        }
        
        .option.correct {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        
        .option.incorrect {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        
        .hidden {
            display: none;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            width: 100%;
        }
        
        .topic-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            margin: 10px 0;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .stat-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div id="loadingScreen">
            <div class="card">
                <div class="loading">
                    <h2>üîÑ –ó–∞–≥—Ä—É–∑–∫–∞...</h2>
                    <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</p>
                </div>
            </div>
        </div>

        <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="mainScreen" class="hidden">
            <div class="header">
                <h1>üéì –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–Ω–∞–∂—ë—Ä</h1>
                <p>–ò–∑—É—á–∞–π —Ñ–æ—Ä–º—É–ª—ã —Å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º!</p>
            </div>

            <div class="card">
    <h3>üìö –í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É</h3>
    <button onclick="startQuiz('trigonometry')">üìê –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è</button>
    <button onclick="startQuiz('logarithms')">üìä –õ–æ–≥–∞—Ä–∏—Ñ–º—ã</button>
    <button onclick="startQuiz('derivatives')">üìà –ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ</button>
    <button onclick="showProgress()">üìä –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
</div>

            
            <div class="card">
                <h3>üìä –¢–≤–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats">
                    <div class="stat-item">
                        <div>‚úÖ</div>
                        <div id="correctCount">0</div>
                        <small>–ü—Ä–∞–≤–∏–ª—å–Ω–æ</small>
                    </div>
                    <div class="stat-item">
                        <div>üìù</div>
                        <div id="totalCount">0</div>
                        <small>–í—Å–µ–≥–æ</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã -->
        <div id="quizScreen" class="hidden">
            <div class="header">
                <h2 id="topicTitle">–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è</h2>
                <p>–í–æ–ø—Ä–æ—Å <span id="currentQ">1</span> –∏–∑ <span id="totalQ">5</span></p>
            </div>
            
            <div class="card">
                <div class="question" id="questionText">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div class="options" id="optionsContainer">
                    <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
                </div>
            </div>
            
            <div class="card hidden" id="resultCard">
                <h3 id="resultText"></h3>
                <p id="explanationText"></p>
                <button onclick="nextQuestion()">–°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å</button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏ -->
        <div id="errorScreen" class="hidden">
            <div class="card">
                <h2>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2>
                <div class="error" id="errorMessage"></div>
                <button onclick="location.reload()">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            Telegram.WebApp.setHeaderColor('#667eea');
            Telegram.WebApp.setBackgroundColor('#667eea');
        }

        let questions = {};
        let currentTopic = '';
        let currentQuestionIndex = 0;
        let correctAnswers = 0;
        let totalAnswers = 0;

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –∏–∑ JSON —Ñ–∞–π–ª–∞
        async function loadQuestions() {
            try {
                console.log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –≤–æ–ø—Ä–æ—Å–æ–≤...');
                const response = await fetch('questions.json');
                
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);
                }
                
                questions = await response.json();
                console.log('‚úÖ –í–æ–ø—Ä–æ—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', questions);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
                showMainScreen();
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                showError(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã: ${error.message}`);
            }
        }

        function showMainScreen() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('mainScreen').classList.remove('hidden');
            
            const topicsContainer = document.getElementById('topicsContainer');
            topicsContainer.innerHTML = '';
            
            // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–µ–º—ã
            const topicNames = {
                trigonometry: 'üìê –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è',
                algebra: 'üî¢ –ê–ª–≥–µ–±—Ä–∞', 
                geometry: 'üìè –ì–µ–æ–º–µ—Ç—Ä–∏—è',
                logarithms: 'üìä –õ–æ–≥–∞—Ä–∏—Ñ–º—ã'
            };
            
            for (const [topicKey, topicName] of Object.entries(topicNames)) {
                if (questions[topicKey] && questions[topicKey].length > 0) {
                    const button = document.createElement('button');
                    button.className = 'topic-btn';
                    button.innerHTML = `${topicName} <small>(${questions[topicKey].length} –≤–æ–ø—Ä–æ—Å–æ–≤)</small>`;
                    button.onclick = () => startTopic(topicKey);
                    topicsContainer.appendChild(button);
                }
            }
        }

        function showError(message) {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('errorScreen').classList.remove('hidden');
            document.getElementById('errorMessage').textContent = message;
        }

        function startTopic(topic) {
            currentTopic = topic;
            currentQuestionIndex = 0;
            
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã
            shuffleArray(questions[topic]);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
            document.getElementById('mainScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã
            const topicNames = {
                trigonometry: 'üìê –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è',
                algebra: 'üî¢ –ê–ª–≥–µ–±—Ä–∞', 
                geometry: 'üìè –ì–µ–æ–º–µ—Ç—Ä–∏—è',
                logarithms: 'üìä –õ–æ–≥–∞—Ä–∏—Ñ–º—ã'
            };
            document.getElementById('topicTitle').textContent = topicNames[topic];
            document.getElementById('totalQ').textContent = questions[topic].length;
            
            showQuestion();
        }

        function showQuestion() {
            const question = questions[currentTopic][currentQuestionIndex];
            const optionsContainer = document.getElementById('optionsContainer');
            const resultCard = document.getElementById('resultCard');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            optionsContainer.innerHTML = '';
            resultCard.classList.add('hidden');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('currentQ').textContent = currentQuestionIndex + 1;
            
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
            const shuffledOptions = [...question.options];
            shuffleArray(shuffledOptions);
            const correctAnswerIndex = shuffledOptions.indexOf(question.options[question.correct]);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
            shuffledOptions.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = option;
                optionElement.onclick = () => checkAnswer(index, correctAnswerIndex);
                optionsContainer.appendChild(optionElement);
            });
        }

        function checkAnswer(selectedIndex, correctIndex) {
            const options = document.querySelectorAll('.option');
            const resultCard = document.getElementById('resultCard');
            const resultText = document.getElementById('resultText');
            const explanationText = document.getElementById('explanationText');
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
            options.forEach(opt => opt.style.pointerEvents = 'none');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            totalAnswers++;
            document.getElementById('totalCount').textContent = totalAnswers;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç
            if (selectedIndex === correctIndex) {
                options[selectedIndex].classList.add('correct');
                resultText.textContent = '‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!';
                resultText.style.color = '#4CAF50';
                correctAnswers++;
                document.getElementById('correctCount').textContent = correctAnswers;
            } else {
                options[selectedIndex].classList.add('incorrect');
                options[correctIndex].classList.add('correct');
                resultText.textContent = '‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ';
                resultText.style.color = '#f44336';
            }
            
            explanationText.textContent = questions[currentTopic][currentQuestionIndex].explanation;
            resultCard.classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex >= questions[currentTopic].length) {
                // –ö–æ–Ω–µ—Ü –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
                if (window.Telegram && Telegram.WebApp) {
                    Telegram.WebApp.showPopup({
                        title: 'üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!',
                        message: `–í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Ç–µ–º—É! –ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: ${correctAnswers}/${questions[currentTopic].length}`
                    });
                }
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
                document.getElementById('quizScreen').classList.add('hidden');
                document.getElementById('mainScreen').classList.remove('hidden');
            } else {
                showQuestion();
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è –º–∞—Å—Å–∏–≤–∞
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        document.addEventListener('DOMContentLoaded', loadQuestions);
    </script>
</body>
</html>
